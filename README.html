<h1 id="backend">Backend</h1>
<p>C'est qu'il faut penser Ã  coder notre backend maintenant ğŸ˜²</p>
<p>Et aprÃ¨s avoir mis en place un petit framework, on va dÃ©sormais utiliser <em>Lumen</em>, le micro-framework de <em>Laravel</em> !</p>
<p><details><summary>rÃ©action attendueâ€¦</summary></p>
<p><img src="https://media.giphy.com/media/5GoVLqeAOo6PK/giphy.gif" alt="" /></p>
<p><details><summary>ouâ€¦</summary></p>
<p><img src="https://media.giphy.com/media/b5LTssxCLpvVe/giphy.gif" alt="" /></p>
<p><details><summary>ouâ€¦</summary></p>
<p><img src="https://media.giphy.com/media/BlVnrxJgTGsUw/giphy.gif" alt="" /></p>
<p><details><summary>ouâ€¦</summary></p>
<p><img src="https://media.giphy.com/media/nXxOjZrbnbRxS/giphy.gif" alt="" /></p>
<p><details><summary>tu as saisi l'idÃ©e ?</summary></p>
<p><img src="https://media.giphy.com/media/3o7abKhOpu0NwenH3O/giphy.gif" alt="" /></p>
<p></details></p>
<p></details></p>
<p></details></p>
<p></details></p>
<p></details></p>
<h2 id="etapes">Etapes</h2>
<h3 id="1-configuration-wrench">#1 Configuration ğŸ”§</h3>
<ul>
<li>installer les dÃ©pendances <code>composer install</code></li>
<li>crÃ©er le fichier de config <code>.env</code> (Ã©quivalent de notre <code>app/config.ini</code>)</li>
<li>dupliquer le fichier <code>.env.example</code></li>
<li>renommer la copie en <code>.env</code></li>
<li>puis renseigner les valeurs dans le fichier <code>.env</code></li>
<li>dans le fichier <code>bootstrap/app.php</code></li>
<li>la ligne <code>$app-&gt;withEloquent();</code> est dÃ©commentÃ©e (par dÃ©faut, elle est commentÃ©e)</li>
<li>la ligne <code>$app-&gt;withFacades();</code> est dÃ©commentÃ©e (par dÃ©faut, elle est commentÃ©e)</li>
<li><strong>Eloquent</strong> est <a href="https://fr.wikipedia.org/wiki/Mapping_objet-relationnel">un ORM</a> respectant la conception <em>Active Record</em></li>
<li><a href="https://fr.wikipedia.org/wiki/Fa%C3%A7ade_(patron_de_conception)">les <strong>Facades</strong></a> permettent de simplifier l'utilisation de certaines fonctionnalitÃ©s de <em>Lumen</em></li>
<li>sans <code>facade</code> :<br />
<code>php
$results = app('db')-&gt;select("SELECT * FROM users");
</code></li>
<li>avec <code>facade</code> :<br />
<code>php
$results = DB::select("SELECT * FROM users");
</code></li>
<li>Ã§a fonctionne tout autant, mais c'est plus simple !</li>
</ul>
<h3 id="2-premiÃ¨re-page-one">#2 PremiÃ¨re page :one:</h3>
<ul>
<li>la route pour la premiÃ¨re page est dÃ©jÃ  codÃ©e</li>
<li>mais ce n'est pas le cas du <em>Controller</em> et de la mÃ©thode du <em>Controller</em></li>
<li>analyse la dÃ©claration de la route pour connaÃ®tre le nom du <em>Controller</em> Ã  dÃ©clarer</li>
<li><a href="https://lumen.laravel.com/docs/routing">cette doc sur le routage</a> peut aider</li>
<li>crÃ©er ce <em>Controller</em></li>
<li><a href="https://lumen.laravel.com/docs/controllers">cette doc sur les <em>Controllers</em></a> peut aider</li>
<li>dÃ©clarer la mÃ©thode</li>
<li>et y placer un petit <em>echo</em></li>
<li>la page est dÃ©sormais consultable via un navigateur</li>
<li>pour vÃ©rifier, on va lancer un serveur Web spÃ©cifique, celui de PHP (et oui, pas de Apache cette fois encore)</li>
<li>dans le terminal, se placer Ã  la racine du projet/dÃ©pÃ´t</li>
<li>exÃ©cuter : <code>php -S 0.0.0.0:8080 -t public</code> (comme en S06 ğŸ‰)</li>
<li>dÃ©sormais, on pourrait gÃ©nÃ©rer du code HTML grÃ¢ce <a href="https://lumen.laravel.com/docs/views">aux <em>Views</em> (et sa doc)</a></li>
<li>mais on veut surtout gÃ©nÃ©rer du code JSON, donc pas de <em>View</em>â€¦</li>
</ul>
<h3 id="3-retourner-un-json-books">#3 Retourner un JSON ğŸ“š</h3>
<ul>
<li>crÃ©er une route avec les infos suivantes :</li>
<li>URL : <code>/categories</code></li>
<li>HTTP Method : <code>GET</code></li>
<li><em>Controller</em> : <code>CategoryController</code></li>
<li>Method : <code>list</code></li>
<li>coder le <em>Controller</em> et dÃ©clarer la mÃ©thode</li>
<li>retourner la version JSON du tableau ci-dessous</li>
<li><a href="https://lumen.laravel.com/docs/responses#json-responses">cette doc sur les Responses HTTP</a> peut aider</li>
</ul>
<p><details><summary>Tableau</summary></p>
<pre><code class="hljs php language-php"><span class="hljs-variable">$categoriesList</span> = [
  <span class="hljs-number">1</span> =&gt; [
    <span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-number">1</span>,
    <span class="hljs-string">&#x27;name&#x27;</span> =&gt; <span class="hljs-string">&#x27;Chemin vers O\&#x27;clock&#x27;</span>,
    <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-number">1</span>
  ],
  <span class="hljs-number">2</span> =&gt; [
    <span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-number">2</span>,
    <span class="hljs-string">&#x27;name&#x27;</span> =&gt; <span class="hljs-string">&#x27;Courses&#x27;</span>,
    <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-number">1</span>
  ],
  <span class="hljs-number">3</span> =&gt; [
    <span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-number">3</span>,
    <span class="hljs-string">&#x27;name&#x27;</span> =&gt; <span class="hljs-string">&#x27;O\&#x27;clock&#x27;</span>,
    <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-number">1</span>
  ],
  <span class="hljs-number">4</span> =&gt; [
    <span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-number">4</span>,
    <span class="hljs-string">&#x27;name&#x27;</span> =&gt; <span class="hljs-string">&#x27;Titre Professionnel&#x27;</span>,
    <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-number">1</span>
  ]
];
</code></pre>
<p></details></p>
<h3 id="4-retourner-les-donnÃ©es-dun-Ã©lÃ©ment-en-particulier-notebook">#4 Retourner les donnÃ©es d'un Ã©lÃ©ment en particulier ğŸ““</h3>
<ul>
<li>crÃ©er une route avec les infos suivantes :</li>
<li>URL : <code>/categories/[id]</code> oÃ¹ <code>[id]</code> est une portion dynamique de l'URL (mais il faut bien <a href="https://lumen.laravel.com/docs/routing#required-parameters">lire cette doc</a>)</li>
<li>HTTP Method : <code>GET</code></li>
<li><em>Controller</em> : <code>CategoryController</code></li>
<li>Method : <code>item</code></li>
<li>coder le <em>Controller</em> et dÃ©clarer la mÃ©thode</li>
<li>rÃ©cupÃ©rer la portion dynamique de l'URL, nommÃ©e <code>id</code></li>
<li>rÃ©cupÃ©rer ensuite les donnÃ©es sur la catÃ©gorie de cet <code>id</code></li>
<li>utiliser le tableau de l'Ã©tape prÃ©cÃ©dente</li>
<li>et oui, on va copier-coller ce tableau ğŸ˜±</li>
<li>retourner la version JSON de ces donnÃ©es</li>
</ul>
<h3 id="5-404-not-found-no_entry_sign">#5 404 not found ğŸš«</h3>
<ul>
<li>on va amÃ©liorer le code du <em>Endpoint</em> de l'Ã©tape prÃ©cÃ©dente</li>
<li>si l'id fourni n'existe pas dans notre tableau, alors, on envoie une erreur 404 (sans affichage)</li>
<li><a href="https://laravel.com/docs/errors#http-exceptions">cette doc sur les <em>Exceptions HTTP</em></a> peut aider</li>
</ul>
<h3 id="6-parce-que-cest-cool-sunglasses">#6 Parce que c'est cool ğŸ˜</h3>
<ul>
<li>on peut lire <a href="https://lumen.laravel.com/docs/responses#redirects">la doc sur les redirections</a></li>
<li>on peut lire <a href="https://laravel.com/docs/logging#writing-log-messages">la doc sur les logs</a></li>
<li>on pourrait lire <a href="https://lumen.laravel.com/docs">toute la doc</a>, mais Ã§a serait fastidieux ğŸ˜µ</li>
<li>on ira donc piocher dedans quand on aura un besoin ğŸ˜Œ</li>
</ul>